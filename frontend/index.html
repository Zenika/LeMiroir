<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>MARCEL v2</title>
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="bower_components/polymer/polymer.html">
  <link rel="import" href="css/shared-styles.html">
  <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/weather-icons.min.css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>

  <div id="error_container">
    <div id="error">
    </div>
  </div>
  <section id="components"></section>
  <paper-toast text="Hello world!" opened></paper-toast>

  <script src="bower_components/polymer-application-loader/loader.js"></script>
  <script src="./src/utils.js"></script>
  <script src="./src/config.js"></script>
  <script src="./src/load.js"></script>
  <script src="./src/error.js"></script>
  <script src="./src/websocket.js"></script>
  <script>
    let loaded = false

    document.body.onload = () => {
      if (loaded) return
      loaded = true

      location.queryString = {};
      location.search.substr(1).split("&").forEach(function (pair) {
        if (pair === "") return;
        var parts = pair.split("=");
        location.queryString[parts[0]] = parts[1] &&
          decodeURIComponent(parts[1].replace(/\+/g, " "));
      });

      console.log("Begin loading process...")
      loadLocalConfig()
        .then(loadRemoteConfig)
        .then(loadMedia)
        .then(openWebsocketConnection)
        .catch(error => {
          document.querySelector("#components").style.visibility = "hidden"
          showError(error)
          console.error(error)
        })
        .then("Loading process finished")
    }
  </script>
</body>

</html>